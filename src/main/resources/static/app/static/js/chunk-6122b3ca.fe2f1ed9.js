(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6122b3ca"],{"67c8":function(e,t,a){},af91:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"addPage app-content"},[a("el-row",{attrs:{gutter:20}},[a("el-col",{staticStyle:{"padding-bottom":"100px",position:"relative"}},[a("title-card",{attrs:{"title-text":"训管动态新增"}}),e._v(" "),a("svg-icon",{staticClass:"icon",staticStyle:{cursor:"pointer",position:"absolute",right:"20px",top:"15px"},attrs:{"icon-class":"goback"},on:{click:e.backFn}}),e._v(" "),a("div",{staticStyle:{padding:"20px 0"}},[a("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"150px"}},[a("el-col",{attrs:{span:16}},[a("el-col",{attrs:{span:10}},[a("el-form-item",{attrs:{label:"动态类型",prop:"newsType"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.newsType,callback:function(t){e.$set(e.form,"newsType",t)},expression:"form.newsType"}},[a("el-option",{attrs:{label:"上级工作动态",value:"上级工作动态"}}),e._v(" "),a("el-option",{attrs:{label:"机关部队训练风采",value:"机关部队训练风采"}}),e._v(" "),a("el-option",{attrs:{label:"安全管理",value:"安全管理"}})],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:10}},[a("el-form-item",{attrs:{label:"发布单位",required:""}},[a("el-input",{attrs:{disabled:""},model:{value:e.deptName,callback:function(t){e.deptName=t},expression:"deptName"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:10}},[a("el-form-item",{attrs:{label:"动态标题",prop:"title"}},[a("el-input",{model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"编辑内容"}},[a("ueditor",{ref:"content",model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}})],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"上传封面"}},[a("el-upload",{ref:"upload",staticClass:"upload-demo default-upload-list wh-100",attrs:{accept:".png,.jpeg,.jpg",drag:"",action:e.fileUrl,data:e.access_token,name:"pdf","file-list":e.imgList,"list-type":"picture-card","on-success":e.uploadImg,"on-error":e.errorFile,"on-remove":e.removeImg,"on-change":e.handleChangeFile,multiple:"",limit:1}},[a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1)],1)],1)],1),e._v(" "),a("el-col",{staticStyle:{"text-align":"center","margin-top":"30px"},attrs:{span:24}},[a("el-button",{attrs:{type:"success"},on:{click:e.saveFn}},[e._v("发布")]),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:"0"!=e.flag,expression:"flag!='0'"}],staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:e.saveDraft}},[e._v("存草稿")])],1)],1)],1)],1)},i=[],n=(a("28a5"),a("aa2a")),l=a("35b7"),o=a("63f4"),r={components:{Ueditor:o["a"],TitleCard:l["a"]},props:{id:{type:String,default:""},flag:{type:String,default:""}},data:function(){return{form:{title:"",newsType:"",content:"",pIds:"",picutureName:""},rules:{newsType:[{required:!0,message:"请选择动态类型",trigger:"change"}],title:[{required:!0,message:"请填写动态标题",trigger:"blur"}]},deptName:"",isRelease:"",imgList:[],fileUrl:"/app/xlgl/news/upLoadFile",access_token:this.$store.state.user.token}},created:function(){this.getDeptName(),this.id&&this.eidtOrUpdate()},methods:{getDeptName:function(){var e=this;Object(n["d"])().then(function(t){e.deptName=t.data.deptName})},eidtOrUpdate:function(){var e=this;Object(n["f"])({id:this.id}).then(function(t){var a=t.data.xlglNews,s=a.title,i=a.newsType,n=a.content;Object.assign(e.form,{title:s,newsType:i,content:n}),e.isRelease=t.data.xlglNews.isRelease,t.data.xlglNews.picturePath&&e.imgList.push({name:t.data.xlglNews.pictureName,url:"/app/xlgl/xlgldocumentfile/downLoad?fileId=".concat(t.data.xlglNews.picturePath)}),e.$refs.content.setContent(e.form.content)})},backFn:function(){this.$emit("back",0)},uploadImg:function(e){e.fileId&&e.fileId.length>0?(this.form.pIds=e.fileId,this.form.picutureName=e.picutureName):this.errorFile()},errorFile:function(){this.$notify({title:"提示",message:"上传失败!",duration:1500,type:"warning"})},removeImg:function(e){var t=this;Object(n["c"])({infoId:this.id,pictureId:e.url.split("=")[1]}).then(function(e){"success"===e.data.result?(t.$notify({title:"提示",message:"图片删除成功",duration:1500,type:"success"}),t.form.picutureName="",t.form.pIds=""):t.$notify({title:"提示",message:"图片删除失败!",duration:1500,type:"warning"})})},handleChangeFile:function(e,t){t.length>1&&t.splice(0,1)},saveData:function(e,t){var a=this;this.$refs[t].validate(function(t){if(!t)return!1;a.form.isRelease=e,a.form.content=a.$refs.content.getContent(),a.id&&(a.form.id=a.id),Object(n["i"])(a.form).then(function(t){"success"===t.data.result?a.id?("1"===e&&"1"===a.isRelease&&a.$notify({title:"提示",message:"修改成功!",duration:1500,type:"success"}),"0"===e&&a.$notify({title:"提示",message:"存入草稿箱成功!",duration:1500,type:"success"}),"1"===e&&"0"===a.isRelease&&a.$notify({title:"提示",message:"发布成功!",duration:1500,type:"success"})):("1"===e&&a.$notify({title:"提示",message:"发布成功!",duration:1500,type:"success"}),"0"===e&&a.$notify({title:"提示",message:"存入草稿箱成功!",duration:1500,type:"success"})):a.id?("1"===e&&"1"===a.isRelease&&a.$notify({title:"提示",message:"修改失败!",duration:1500,type:"warning"}),"0"===e&&a.$notify({title:"提示",message:"存入草稿箱失败!",duration:1500,type:"warning"}),"1"===e&&"0"===a.isRelease&&a.$notify({title:"提示",message:"发布失败!",duration:1500,type:"warning"})):("1"===e&&a.$notify({title:"提示",message:"发布失败!",duration:1500,type:"warning"}),"0"===e&&a.$notify({title:"提示",message:"存入草稿箱失败!",duration:1500,type:"warning"})),a.form="",a.$emit("back",0)})})},saveFn:function(){this.saveData("1","form")},saveDraft:function(){this.saveData("0","form")}}},c=r,p=(a("d1f1"),a("2877")),u=Object(p["a"])(c,s,i,!1,null,"591e9504",null);t["default"]=u.exports},d1f1:function(e,t,a){"use strict";var s=a("67c8"),i=a.n(s);i.a}}]);